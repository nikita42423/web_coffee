{% extends 'base.html' %}
{% load static %}

{% block title %}–§–∏–ª—å–º–æ—Ç–µ–∫–∞ - –°–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã{% endblock %}

{% block extra_css %}
<style>
    :root {
        --films-bg: #141414;
        --films-card-bg: #1f1f1f;
        --films-text: #ffffff;
        --films-text-secondary: #b3b3b3;
        --films-hover: #2a2a2a;
        --films-primary: #e50914;
        --films-primary-hover: #f40612;
    }
    
    body {
        background: var(--films-bg);
        color: var(--films-text);
    }
    
    /* –•–µ–¥–µ—Ä –∫–∞–∫ —É –∫–∏–Ω–æ—Å–∞–π—Ç–æ–≤ */
    .films-header {
        background: linear-gradient(to bottom, rgba(20,20,20,0.9) 0%, rgba(20,20,20,0.8) 50%, rgba(20,20,20,0) 100%);
        padding: 20px 4%;
        position: sticky;
        top: 0;
        z-index: 1000;
        backdrop-filter: blur(10px);
    }
    
    .films-nav {
        display: flex;
        align-items: center;
        gap: 40px;
    }
    
    .films-logo {
        font-size: 1.8em;
        font-weight: bold;
        color: var(--films-primary);
        text-decoration: none;
        text-transform: uppercase;
    }
    
    .films-menu {
        display: flex;
        gap: 20px;
        flex: 1;
    }
    
    .films-menu a {
        color: var(--films-text-secondary);
        text-decoration: none;
        font-size: 0.9em;
        transition: color 0.3s;
    }
    
    .films-menu a:hover,
    .films-menu a.active {
        color: var(--films-text);
    }
    
    .films-search {
        display: flex;
        gap: 10px;
    }
    
    .films-search input {
        background: rgba(0,0,0,0.7);
        border: 1px solid var(--films-text-secondary);
        color: var(--films-text);
        padding: 8px 15px;
        border-radius: 4px;
        width: 250px;
    }
    
    .films-search button {
        background: var(--films-primary);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .hero-section {
        height: 70vh;
        background-size: cover;
        background-position: center;
        position: relative;
        margin-bottom: 50px;
    }
    
    .hero-content {
        position: absolute;
        bottom: 30%;
        left: 4%;
        max-width: 600px;
    }
    
    .hero-title {
        font-size: 3em;
        margin-bottom: 20px;
    }
    
    .hero-buttons {
        display: flex;
        gap: 15px;
    }
    
    .hero-btn {
        padding: 12px 30px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
    }
    
    .hero-btn-primary {
        background: var(--films-primary);
        color: white;
    }
    
    .hero-btn-secondary {
        background: rgba(109,109,110,0.7);
        color: white;
    }
    
    /* –°–µ–∫—Ü–∏–∏ —Å —Ñ–∏–ª—å–º–∞–º–∏ */
    .films-section {
        padding: 20px 4%;
        margin-bottom: 40px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .section-title {
        font-size: 1.5em;
        font-weight: normal;
    }
    
    .section-link {
        color: var(--films-text-secondary);
        text-decoration: none;
        font-size: 0.9em;
    }
    
    /* –ö–∞—Ä—É—Å–µ–ª—å —Ñ–∏–ª—å–º–æ–≤ */
    .films-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
    }
    
    .film-card {
        position: relative;
        border-radius: 4px;
        overflow: hidden;
        transition: transform 0.3s;
        cursor: pointer;
        background: var(--films-card-bg);
    }
    
    .film-card:hover {
        transform: scale(1.05);
        z-index: 10;
    }
    
    .film-poster {
        aspect-ratio: 2/3;
        width: 100%;
        object-fit: cover;
    }
    
    .film-info {
        padding: 15px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .film-card:hover .film-info {
        opacity: 1;
    }
    
    .film-title {
        font-weight: bold;
        margin-bottom: 5px;
        color: white;
    }
    
    .film-meta {
        display: flex;
        gap: 10px;
        font-size: 0.8em;
        color: var(--films-text-secondary);
    }
    
    .film-badges {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 5px;
    }
    
    .badge {
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.7em;
        font-weight: bold;
    }
    
    .badge-sub {
        background: #00a8e1;
        color: white;
    }
    
    .badge-sign {
        background: #8e44ad;
        color: white;
    }
    
    .badge-audio {
        background: #27ae60;
        color: white;
    }
    
    .badge-rating {
        background: #f5c518;
        color: black;
    }
    
    /* –§–∏–ª—å—Ç—Ä—ã */
    .filters-bar {
        background: var(--films-card-bg);
        padding: 15px 4%;
        margin-bottom: 30px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .filter-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .filter-label {
        color: var(--films-text-secondary);
    }
    
    .filter-select {
        background: rgba(0,0,0,0.5);
        color: white;
        border: 1px solid var(--films-text-secondary);
        padding: 5px 10px;
        border-radius: 3px;
    }
    
    /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 40px 0;
    }
    
    .page-link {
        padding: 8px 12px;
        background: var(--films-card-bg);
        color: var(--films-text-secondary);
        text-decoration: none;
        border-radius: 4px;
    }
    
    .page-link:hover,
    .page-link.current {
        background: var(--films-primary);
        color: white;
    }
    
    @media (max-width: 768px) {
        .films-nav {
            flex-direction: column;
            gap: 15px;
        }
        
        .films-menu {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .films-search {
            width: 100%;
        }
        
        .films-search input {
            flex: 1;
        }
        
        .films-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
    }
</style>
{% endblock %}

{% block content %}
<header class="films-header">
    <nav class="films-nav">
        <a href="{% url 'films:list' %}" class="films-logo">–§–ò–õ–¨–ú–û–¢–ï–ö–ê</a>
        <div class="films-menu">
            <a href="{% url 'films:list' %}?type=all" class="{% if current_type == 'all' %}active{% endif %}">–í—Å–µ</a>
            <a href="{% url 'films:list' %}?type=movie" class="{% if current_type == 'movie' %}active{% endif %}">–§–∏–ª—å–º—ã</a>
            <a href="{% url 'films:list' %}?type=series" class="{% if current_type == 'series' %}active{% endif %}">–°–µ—Ä–∏–∞–ª—ã</a>
            <a href="{% url 'films:list' %}?type=cartoon" class="{% if current_type == 'cartoon' %}active{% endif %}">–ú—É–ª—å—Ç—Ñ–∏–ª—å–º—ã</a>
            <a href="{% url 'films:list' %}?type=anime" class="{% if current_type == 'anime' %}active{% endif %}">–ê–Ω–∏–º–µ</a>
        </div>
        <form class="films-search" action="{% url 'films:search' %}" method="get">
            <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..." value="{{ query }}">
            <button type="submit">üîç</button>
        </form>
    </nav>
</header>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filters-bar">
    <div class="filter-group">
        <span class="filter-label">–ñ–∞–Ω—Ä:</span>
        <select class="filter-select" onchange="window.location.href=this.value">
            <option value="{% url 'films:list' %}">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
            {% for genre in genres %}
                <option value="{% url 'films:list' %}?genre={{ genre.slug }}" 
                        {% if current_genre == genre.slug %}selected{% endif %}>
                    {{ genre.name }} ({{ genre.films_count }})
                </option>
            {% endfor %}
        </select>
    </div>
    
    <div class="filter-group">
        <span class="filter-label">–ì–æ–¥:</span>
        <select class="filter-select" onchange="window.location.href=this.value">
            <option value="{% url 'films:list' %}">–í—Å–µ –≥–æ–¥—ã</option>
            {% for y in years %}
                <option value="{% url 'films:list' %}?year={{ y }}"
                        {% if year == y|stringformat:"i" %}selected{% endif %}>
                    {{ y }}
                </option>
            {% endfor %}
        </select>
    </div>
    
    <div class="filter-group">
        <span class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
        <select class="filter-select" onchange="window.location.href=this.value">
            <option value="{% url 'films:list' %}?sort=-created_at">–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
            <option value="{% url 'films:list' %}?sort=-views_count">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
            <option value="{% url 'films:list' %}?sort=-year">–ü–æ –≥–æ–¥—É (–Ω–æ–≤—ã–µ)</option>
            <option value="{% url 'films:list' %}?sort=year">–ü–æ –≥–æ–¥—É (—Å—Ç–∞—Ä—ã–µ)</option>
            <option value="{% url 'films:list' %}?sort=title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
        </select>
    </div>
</div>

<!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã -->
{% if popular_films and not query %}
<section class="films-section">
    <div class="section-header">
        <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ —Å–µ–π—á–∞—Å</h2>
        <a href="#" class="section-link">–í—Å–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ ‚Üí</a>
    </div>
    
    <div class="films-grid">
        {% for film in popular_films %}
        <a href="{% url 'films:detail' film.slug %}" class="film-card">
            {% if film.poster %}
                <img src="{{ film.poster.url }}" alt="{{ film.title }}" class="film-poster">
            {% else %}
                <div class="film-poster" style="background: #2a2a2a; display: flex; align-items: center; justify-content: center;">
                    üé¨
                </div>
            {% endif %}
            
            <div class="film-badges">
                {% if film.has_subtitles %}
                    <span class="badge badge-sub" title="–ï—Å—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã">üìù</span>
                {% endif %}
                {% if film.has_sign_language %}
                    <span class="badge badge-sign" title="–ï—Å—Ç—å –∂–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥">ü§ü</span>
                {% endif %}
                {% if film.has_audio_description %}
                    <span class="badge badge-audio" title="–ï—Å—Ç—å –∞—É–¥–∏–æ–æ–ø–∏—Å–∞–Ω–∏–µ">üéß</span>
                {% endif %}
                {% if film.imdb_rating %}
                    <span class="badge badge-rating">{{ film.imdb_rating }}</span>
                {% endif %}
            </div>
            
            <div class="film-info">
                <div class="film-title">{{ film.title }}</div>
                <div class="film-meta">
                    <span>{{ film.year }}</span>
                    <span>üëÅ {{ film.views_count }}</span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ —Ñ–∏–ª—å–º–æ–≤ -->
<section class="films-section">
    <div class="section-header">
        <h2 class="section-title">
            {% if query %}
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ "{{ query }}"
            {% else %}
                –í—Å–µ —Ñ–∏–ª—å–º—ã
            {% endif %}
        </h2>
        <span class="section-link">–ù–∞–π–¥–µ–Ω–æ: {{ films.paginator.count }}</span>
    </div>
    
    <div class="films-grid">
        {% for film in films %}
        <a href="{% url 'films:detail' film.slug %}" class="film-card">
            {% if film.poster %}
                <img src="{{ film.poster.url }}" alt="{{ film.title }}" class="film-poster">
            {% else %}
                <div class="film-poster" style="background: #2a2a2a; display: flex; align-items: center; justify-content: center;">
                    üé¨
                </div>
            {% endif %}
            
            <div class="film-badges">
                {% if film.has_subtitles %}
                    <span class="badge badge-sub" title="–ï—Å—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã">üìù</span>
                {% endif %}
                {% if film.has_sign_language %}
                    <span class="badge badge-sign" title="–ï—Å—Ç—å –∂–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥">ü§ü</span>
                {% endif %}
                {% if film.has_audio_description %}
                    <span class="badge badge-audio" title="–ï—Å—Ç—å –∞—É–¥–∏–æ–æ–ø–∏—Å–∞–Ω–∏–µ">üéß</span>
                {% endif %}
                {% if film.imdb_rating %}
                    <span class="badge badge-rating">{{ film.imdb_rating }}</span>
                {% endif %}
            </div>
            
            <div class="film-info">
                <div class="film-title">{{ film.title }}</div>
                <div class="film-meta">
                    <span>{{ film.year }}</span>
                    <span>{{ film.get_content_type_display }}</span>
                </div>
            </div>
        </a>
        {% empty %}
        <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
            <h3>üòï –§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if films.has_other_pages %}
    <div class="pagination">
        {% if films.has_previous %}
            <a href="?page=1{% if query %}&q={{ query }}{% endif %}{% if current_genre %}&genre={{ current_genre }}{% endif %}{% if year %}&year={{ year }}{% endif %}" class="page-link">&laquo;</a>
            <a href="?page={{ films.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_genre %}&genre={{ current_genre }}{% endif %}{% if year %}&year={{ year }}{% endif %}" class="page-link">‚Äπ</a>
        {% endif %}
        
        <span class="page-link current">{{ films.number }}</span>
        
        {% if films.has_next %}
            <a href="?page={{ films.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_genre %}&genre={{ current_genre }}{% endif %}{% if year %}&year={{ year }}{% endif %}" class="page-link">‚Ä∫</a>
            <a href="?page={{ films.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if current_genre %}&genre={{ current_genre }}{% endif %}{% if year %}&year={{ year }}{% endif %}" class="page-link">&raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</section>

<!-- –ü–æ–¥–±–æ—Ä–∫–∏ -->
{% if collections %}
<section class="films-section">
    <div class="section-header">
        <h2 class="section-title">–ü–æ–¥–±–æ—Ä–∫–∏ —Ñ–∏–ª—å–º–æ–≤</h2>
    </div>
    
    <div class="films-grid">
        {% for collection in collections %}
        <a href="{% url 'films:collection' collection.slug %}" class="film-card">
            {% if collection.image %}
                <img src="{{ collection.image.url }}" alt="{{ collection.title }}" class="film-poster">
            {% else %}
                <div class="film-poster" style="background: #2a2a2a; display: flex; align-items: center; justify-content: center;">
                    üìö
                </div>
            {% endif %}
            
            <div class="film-info">
                <div class="film-title">{{ collection.title }}</div>
                <div class="film-meta">
                    <span>{{ collection.films.count }} —Ñ–∏–ª—å–º–æ–≤</span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}